# 2024-NC2-A21-MachineLearning
## ğŸ¥ Youtube Link
(ì¶”í›„ ë§Œë“¤ì–´ì§„ ìœ íŠœë¸Œ ë§í¬ ì¶”ê°€)

## ğŸ’¡ About Augmented Reality
(í•´ë‹¹ ê¸°ìˆ ì— ëŒ€í•œ ì¡°ì‚¬ ë‚´ìš© ì •ë¦¬)
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/cb333f8c-e7af-4486-84f3-ea26c2cdd66d)

- ì´ë¯¸ì§€ë‚˜ í…ìŠ¤íŠ¸, ì‚¬ìš´ë“œë“±ì„ í•™ìŠµí•˜ì—¬ ìƒí™©ì— ëŒ€í•œ ë™ì‘ì„ ì¼ì¼ì´ ì§€ì •í•˜ëŠ” ëŒ€ì‹ , 
ìŠ¤ìŠ¤ë¡œ í•™ìŠµí•˜ì—¬ ëŒ€ì‘í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ë¡ ì´ë‹¤
- ë¬¼ì²´ë‚˜ ì†Œë¦¬ë¥¼ ì¸ì‹í•˜ê±°ë‚˜ ë¶„ì„í•  ìˆ˜ ìˆê³  ì‚¬ìš©ìì˜ íŒ¨í„´ì„ íŒŒì•…í•´ 
ì–´ë– í•œ ê²°ê³¼ë¥¼ ì¶”ì²œí•´ì£¼ê±°ë‚˜ ì˜ˆì¸¡í•  ìˆ˜ë„ ìˆë‹¤.
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/7f14c4f7-e06c-4218-8b9b-a3cc2e25814c)


## ğŸ¯ What we focus on?
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/26617508-30c9-4fca-8696-645574bcfd23)
### SoundClassification

- ìˆ˜ë§ì€ ì•„ì´ë””ì–´ì¤‘ ì˜¤ë¸Œì íŠ¸ ë¶„ë¥˜ì™€ ì†Œë¦¬ë¥¼ ë¶„ì„í•´ì£¼ëŠ”ê²ƒì— í¥ë¯¸ë¥¼ ëŠê¼ˆê³  
ê·¸ì¤‘ ì†Œë¦¬ì— ì§‘ì¤‘í•´ë³´ê³  ì‹¶ì€ ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤
- ì†Œë¦¬ë¥¼ ê³¼ì—° ì–´ë–»ê²Œ ë¶„ì„í•˜ëŠ”ì§€ ì›ë¦¬ë¥¼ ì•Œì§€ ëª»í•´ì„œ ì´ë²ˆ ê¸°íšŒì— ë°°ì›Œë³´ê³ ì‹¶ì—ˆìŠµë‹ˆë‹¤

### AVFoundation

- input ê°’ìœ¼ë¡œ ì˜¤ë””ì˜¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´, ë…¹ìŒ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤

### Idation
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/2a0bd799-4930-4fe6-bccf-d770e219ab90)
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/e4e96c3f-96f7-4c53-b633-08f6e2cbd0cf)


## ğŸ’¼ Use Case
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/85c75bce-7cd2-4e2e-93a6-ce96ce9a992a)


## ğŸ–¼ï¸ Prototype

### 1. ë©”ì¸í™”ë©´
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/1e0f130f-e4da-4b25-a506-c6e99168bb8b)
- Start ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ recordView (ìŒì„±ë…¹ìŒí™”ë©´)ìœ¼ë¡œ ì§„ì…í•©ë‹ˆë‹¤


### 2. ìŒì„± ë…¹ìŒí™”ë©´
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/017cbbb4-c866-415f-a843-b24b6057e10d)
- ì‚¬ìš©ìê°€ ë³´ê³  ì½ì„ ìˆ˜ ìˆëŠ” ì§€ë¬¸ì„ ëœë¤ìœ¼ë¡œ ì œì‹œí•´ ì¤ë‹ˆë‹¤
- ìŒì„± ë…¹ìŒ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìŒì„±ì´ ë…¹ìŒë©ë‹ˆë‹¤
- ë…¹ìŒ ì •ì§€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°”ë¡œ ë¶„ì„ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤


### 3. ìŒì„± ë¶„ì„ ê²°ê³¼ í™”ë©´
  ![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/e7134af6-243c-43c1-91fd-63c0459cbd8a) 
- ë…¹ìŒëœ ìŒì„±ê³¼ í•™ìŠµí•œ ëª¨ë¸ì„ ì ìš©í•˜ì—¬ ëª©ì†Œë¦¬ íƒ€ì…ì— ë”°ë¥¸ ê²°ê³¼ í™”ë©´ì„ ì œê³µí•©ë‹ˆë‹¤

ì´ 8ê°œì˜ ëª©ì†Œë¦¬ íƒ€ì…ì´ ìˆìŠµë‹ˆë‹¤!
![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/d9d7ecad-ce1c-49eb-b749-010d32e2e88a)



## ğŸ› ï¸ About Code
[(í•µì‹¬ ì½”ë“œì— ëŒ€í•œ ì„¤ëª… ì¶”ê°€)](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F2e999faf-43aa-426e-ba81-0a9f876c0c58%2F70245514-95c4-422a-ba7f-fc3c048ff64b%2F5864d500-a1dc-4f84-9066-c71623dfe3a3.png?table=block&id=9c80ce15-cd83-4743-9fe2-cfcafd1adda9&spaceId=2e999faf-43aa-426e-ba81-0a9f876c0c58&width=1420&userId=e7637d63-e92f-4d98-a02f-63f160a8b78e&cache=v2)
- ë‹¤ìŒì€ í”„ë¡œí† íƒ€ì…ì— ì ìš©ëœ ëª¨ë¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¶„ë¥˜í•˜ëŠ” ê³¼ì •ì„ ë‹´ì€ ë‚´ìš©ì…ë‹ˆë‹¤.ë¨¼ì € ëª©ì†Œë¦¬ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì˜€ëŠ”ë°, ì €í¬ëŠ”  ìµœëŒ€í•œ ë¹„ìŠ·í•œ ë¶„ë¥˜ ê¸°ì¤€ìœ¼ë¡œ, ë§ì€ ëª©ì†Œë¦¬ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ëŸ¬ë„ˆë“¤ ëª©ì†Œë¦¬ë¿ë§Œ ì•„ë‹ˆë¼, ë„¤ì´ë²„ í´ë¡œë°” ë”ë¹™ì—ì„œ AI ëª©ì†Œë¦¬ë¥¼ ì¶”ì¶œí•˜ì˜€ê³ ,
ë°±ê·¸ë¼ìš´ë“œ ì†Œë¦¬ë„ í•¨ê»˜ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.
*ì—¬ê¸°ì„œ ë°±ê·¸ë¼ìš´ë“œ ì†Œë¦¬ëŠ” êµ¬ë³„í•  ì‚¬ìš´ë“œê°€ ì—†ì„ ë•Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìš©ë„ì…ë‹ˆë‹¤.
- ì´ë ‡ê²Œ ìˆ˜ì§‘í•œ ë°ì´í„°ëŠ” ì´ 340ê°€ì§€ë¡œ, ì´ë¥¼ genderì™€ voiceTypeìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë¶„ë¥˜í•˜ì˜€ìŠµë‹ˆë‹¤
GenderëŠ” ë§ ê·¸ëŒ€ë¡œ ë‚¨ìì™€ ì—¬ì ëª©ì†Œë¦¬ë¥¼ ë¶„ë¥˜í•˜ì—¬ ë‹´ì•˜ê³ , voiceTypeì€ ëª©ì†Œë¦¬ì˜ í†¤ì´ë‚˜ ì–µì–‘, ë¶„ìœ„ê¸°ì— ë”°ë¼ ë‚¨ì 4ê°€ì§€, ì—¬ì 4ê°€ì§€ì˜ ëª©ì†Œë¦¬ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ ì´ 8ê°€ì§€ì˜ ìœ í˜•ìœ¼ë¡œ êµ¬ë¶„í•˜ì˜€ìŠµë‹ˆë‹¤.

![image](https://github.com/DeveloperAcademy-POSTECH/2024-NC2-A21-MachineLearning/assets/163488928/32f2d601-042a-46a8-80ca-ad08b15ffcb4)
ì´í›„ ëª¨ë¸ì„ ì•±ì— ì ìš©í•  ë•Œ, ì²˜ìŒì—ëŠ” gender ëª¨ë¸ ì—†ì´ ë‚¨,ì—¬ê°€ ëª¨ë‘ í•©ì³ì ¸ ìˆëŠ” voiceType ëª¨ë¸ë¡œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì˜€ëŠ”ë° ì •í™•ë„ê°€ ë§ì´ ë–¨ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.. 
ì˜ˆë¥¼ ë“¤ì–´ ì—¬ìëª©ì†Œë¦¬ì—¬ë„, ì–µì–‘ì´ ë‚®ì•„ì§€ëŠ” ë¶€ë¶„ì—ì„œëŠ” ë‚¨ì ëª©ì†Œë¦¬ë¡œ ì¸ì‹ í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆì–´ìš”.
ë”°ë¼ì„œ genderë¥¼ êµ¬ë³„í•˜ëŠ” ëª¨ë¸ë¡œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ maleê³¼ femaleë¡œ êµ¬ë³„í•œ í›„ì—,
ê°ê°ì˜ ì„±ë³„ì— ë§ëŠ” voiceTypeì„ êµ¬ë³„í•´ì£¼ëŠ” ëª¨ë¸ì„ ì ìš©í•˜ì—¬ ë¶„ì„í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

### Code snippet

**ì˜¤ë””ì˜¤ë¥¼ ë¶„ì„í•´ì„œ ì–»ëŠ” ê²°ê³¼ê°’ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ResultsObserver êµ¬í˜„â¬‡ï¸**

    import Foundation
    import SwiftUI
    import AVFoundation
    import SoundAnalysis
    
    //ì˜¤ë””ì˜¤ ë¶„ì„ìœ¼ë¡œ ë¶€í„° ê²°ê³¼ ë°›ëŠ” íƒ€ì… êµ¬í˜„
    /// An observer that receives results from a classify sound request.
    class ResultsObserver: NSObject, SNResultsObserving {
    
    @Binding var classificationResult: String
    
    //ê° ì‹œê°„ ë²”ìœ„ì˜ classification ê²°ê³¼ë¥¼ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬
    private var classifications: [String: Double] = [:]
    
    //ê°€ì¥ ë§ì´ ë„ì¶œëœ ì˜¤ë””ì˜¤íƒ€ì… ê°’ ë°›ê¸°
    var mostClassificationIdentifier: String
    
    //ì´ˆê¸°í™”
    init(result: Binding<String>){
           _classificationResult = result
           mostClassificationIdentifier = "" // Provide an initial value
           super.init() // Call super.init() after initializing all properties
       }
    
    /// Notifies the observer when a request generates a prediction.
    func request(_ request: SNRequest, didProduce result: SNResult) {
    
		    // ê²°ê³¼ë¥¼ SNClassificationResultë¡œë¶€í„° ë°›ì•„ì˜´
        // SNClassificationResulì€ ì‹œê°„ ë²”ìœ„ì— ëŒ€í•´ ê°€ì¥ ë†’ì€ ìˆœìœ„ì˜ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¨ë‹¤ê³  í•¨
        guard let result = result as? SNClassificationResult else  { return }
        
        //classificationsëŠ” [SNClassification]ì„
        //ì´ëŠ” ìƒìœ„ ë¶„ë¥˜ í›„ë³´ë¥¼ ë‚˜ì—´í•œ ë°°ì—´ì„ ë‚˜íƒ€ëƒ„
        //classification.firstë‹ˆê¹Œ ì ¤ ë†’ì€ ìˆœìœ„ì˜ í›„ë³´ë¥¼ ë°ë ¤ì˜´
        guard let classification = result.classifications.first else { return }
        
        classifications[classification.identifier, default: 0.0] 
        += classification.confidence
        
        //ê°€ì¥ ë§ì´ ë„ì¶œëœ classification ê²°ê³¼ê°’ì„ êµ¬í•˜ëŠ” ë¡œì§
        //BGëŠ” ë”•ì…”ë„ˆë¦¬ì—ì„œ ì‚­ì œ
        classifications["BG"] = nil
        //ë”•ì…”ë„ˆë¦¬ ì•ˆì—ì„œ ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ê°’ êµ¬í•˜ê¸°
        let mostFrequentClassification = classifications.max(by: 
        { $0.value < $1.value })
        
        // ê°€ì¥ ë§ì´ ë„ì¶œëœ identifier
        mostClassificationIdentifier = mostFrequentClassification!.key
     }
    }

ëª¨ë¸ì„ ì—°ê²°í•´ ì˜¤ë””ì˜¤ë¥¼ ë¶„ì„í•˜ëŠ” ë©”ì„œë“œâ¬‡ï¸
 
        func classifyAudio(){
        
        let genderAnalyzer = try! SNAudioFileAnalyzer
        (url: audioRecorder.recordedFile!)
        
        let userTypeAnalyzer = try! SNAudioFileAnalyzer
        (url: audioRecorder.recordedFile!)
        
        let request = try! SNClassifySoundRequest
        (mlModel: genderClassifier().model)
        do{
            try? genderAnalyzer.add(request, withObserver: genderObserver)
            try genderAnalyzer.analyze()
        }
        
        gender = genderObserver.mostClassificationIdentifier
        print(gender)
        
        if gender == "male" {
            let request = try! SNClassifySoundRequest
            (mlModel: maleVoiceClassifier().model)
            do{
                try? userTypeAnalyzer.add(request, 
                withObserver: userTypeObserver)
                try userTypeAnalyzer.analyze()
            }
        }
        else if gender == "female" {
            let request = try! SNClassifySoundRequest
            (mlModel: femaleVoiceClassifier().model)
            do{
                try? userTypeAnalyzer.add(request, 
                withObserver: userTypeObserver)
                try userTypeAnalyzer.analyze()
            }
        }
        
        userType = userTypeObserver.mostClassificationIdentifier
    }

AVFoundationì„ ì‚¬ìš©í•´ ì˜¤ë””ì˜¤ë¥¼ ë…¹ìŒí•˜ëŠ” ê¸°ëŠ¥ â¬‡ï¸
           
            import Foundation
            import AVFoundation
    
    class AudioRecorder: NSObject, ObservableObject, AVAudioPlayerDelegate {
        // ë…¹ìŒ
        var audioRecorder: AVAudioRecorder?
        @Published var isRecording = false
        @Published var isNext = false
    
    // ì¬ìƒ
    var audioPlayer: AVAudioPlayer?
    @Published var isPlaying = false
    @Published var isPaused = false
    
    // ìŒì„± ë©”ëª¨ëœ ë°ì´í„°
    var recordedFile: URL?
    
    // Singleton instance
    static let shared = AudioRecorder()
    
    override init() {
        super.init()
        configureAudioSession()
        checkAudioRecordingPermission()
    }
    
    func configureAudioSession() {
        let audioSession = AVAudioSession.sharedInstance()
        do {
            try audioSession.setCategory(.playAndRecord, mode: .default)
            try audioSession.setActive(true)
        } catch {
            print("Failed to configure audio session: 
            
            \(error.localizedDescription)")
        }
    }
    
    // ìŒì„± ë©”ëª¨ ë…¹ìŒ ê´€ë ¨ ë©”ì„œë“œ
    // ë°›ì•„ì˜¬ ë•Œ í˜•ì‹ê³¼ í™•ì¥ìë¥¼ 
    func startRecording() {
        let fileURL = getDocumentsDirectory()
        .appendingPathComponent("recording-\(Date().timeIntervalSince1970).wav")
        let settings: [String: Any] = [
            AVFormatIDKey: Int(kAudioFormatLinearPCM),
            AVSampleRateKey: 16000.0,
            AVNumberOfChannelsKey: 1, // mono
            AVEncoderAudioQualityKey: AVAudioQuality.high.rawValue,
            AVLinearPCMBitDepthKey: 16,
            AVLinearPCMIsBigEndianKey: false,
            AVLinearPCMIsFloatKey: false
        ]
        
        do {
            audioRecorder = try AVAudioRecorder
            (url: fileURL, settings: settings)
            audioRecorder?.record()
            isRecording = true
            isNext = false
            print("Recording started")
        } catch {
            print("Failed to start recording: \(error.localizedDescription)")
        }
    }
    
    func stopRecording() {
        guard let recorder = audioRecorder else {
            print("Audio recorder is not initialized.")
            return
        }
        recorder.stop()
        recordedFile = recorder.url
        isRecording = false
        isNext = true
        print("Recording stopped: \(String(describing: recordedFile))")
    }
    
    func getDocumentsDirectory() -> URL {
        let paths = FileManager.default.urls(for: .documentDirectory, 
        in: .userDomainMask)
        return paths[0]
    }
     }
        
